<div class="advanced-charts-container" *ngIf="showCharts">
  <!-- Header Section -->
  <div class="charts-header">
    <h2>Advanced Financial Analytics</h2>
    <p class="subtitle">Deep insights and specialized financial visualizations</p>
    
    <div class="chart-controls">
      <div class="control-group">
        <label for="yearSelect">Year:</label>
        <select id="yearSelect" [(ngModel)]="selectedYear" (change)="onYearChange()" class="form-select">
          <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="metricSelect">Primary Metric:</label>
        <select id="metricSelect" [(ngModel)]="selectedMetric" (change)="onMetricChange()" class="form-select">
          <option value="savingsRate">Savings Rate</option>
          <option value="debtToIncome">Debt-to-Income</option>
          <option value="emergencyFund">Emergency Fund</option>
          <option value="investmentRate">Investment Rate</option>
        </select>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-outline-primary" (click)="refreshCharts()" [disabled]="isLoading">
          <i class="fas fa-redo" [class.fa-spin]="isLoading"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Generating advanced analytics...</p>
    </div>
  </div>

  <!-- Advanced Charts Grid -->
  <div class="advanced-charts-grid" *ngIf="!isLoading">
    <!-- Financial Health Indicators -->
    <div class="chart-card large" *ngIf="financialIndicators.length > 0">
      <div class="chart-header">
        <h3>Financial Health Indicators</h3>
        <p class="chart-description">Key metrics for financial wellness assessment</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('indicator')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #indicatorChart></canvas>
      </div>
      <div class="indicators-summary">
        <div class="indicator-item" *ngFor="let indicator of financialIndicators">
          <div class="indicator-name">{{ indicator.name }}</div>
          <div class="indicator-value" [class]="'status-' + indicator.status">
            {{ indicator.value | number:'1.1-1' }}%
          </div>
          <div class="indicator-target">Target: {{ indicator.target }}%</div>
          <div class="indicator-trend" [class]="'trend-' + indicator.trend">
            <i class="fas" [class.fa-arrow-up]="indicator.trend === 'up'" 
               [class.fa-arrow-down]="indicator.trend === 'down'" 
               [class.fa-minus]="indicator.trend === 'stable'"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Spending Heatmap -->
    <div class="chart-card" *ngIf="heatmapData.length > 0">
      <div class="chart-header">
        <h3>Spending Heatmap</h3>
        <p class="chart-description">Daily spending patterns throughout the year</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('heatmap')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #heatmapChart></canvas>
      </div>
      <div class="heatmap-legend">
        <div class="legend-item">
          <span class="legend-color" style="background-color: #f8f9fa;"></span>
          <span class="legend-label">No spending</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #d1ecf1;"></span>
          <span class="legend-label">Low</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #7dd3fc;"></span>
          <span class="legend-label">Medium</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #0ea5e9;"></span>
          <span class="legend-label">High</span>
        </div>
      </div>
    </div>

    <!-- Financial Gauges -->
    <div class="chart-card" *ngIf="gaugeData.length > 0">
      <div class="chart-header">
        <h3>Financial Health Gauges</h3>
        <p class="chart-description">Critical financial ratios at a glance</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('gauge')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #gaugeChart></canvas>
      </div>
      <div class="gauges-summary">
        <div class="gauge-item" *ngFor="let gauge of gaugeData">
          <div class="gauge-label">{{ gauge.label }}</div>
          <div class="gauge-value" [style.color]="gauge.color">
            {{ gauge.value | number:'1.1-1' }}%
          </div>
        </div>
      </div>
    </div>

    <!-- Cash Flow Waterfall -->
    <div class="chart-card" *ngIf="waterfallData">
      <div class="chart-header">
        <h3>Cash Flow Waterfall</h3>
        <p class="chart-description">Monthly income, expenses, and net cash flow</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('waterfall')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #waterfallChart></canvas>
      </div>
    </div>

    <!-- Financial Health Radar -->
    <div class="chart-card" *ngIf="radarData">
      <div class="chart-header">
        <h3>Financial Health Radar</h3>
        <p class="chart-description">Multi-dimensional financial wellness assessment</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('radar')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #radarChart></canvas>
      </div>
    </div>

    <!-- Category Performance Bubble Chart -->
    <div class="chart-card" *ngIf="bubbleData">
      <div class="chart-header">
        <h3>Category Performance Analysis</h3>
        <p class="chart-description">Spending amount vs frequency by category</p>
        <div class="chart-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportChart('bubble')">
            <i class="fas fa-download"></i>
          </button>
        </div>
      </div>
      <div class="chart-container">
        <canvas #bubbleChart></canvas>
      </div>
      <div class="bubble-legend">
        <div class="legend-item">
          <span class="legend-label">Bubble size = Financial impact</span>
        </div>
        <div class="legend-item">
          <span class="legend-label">X-axis = Total amount spent</span>
        </div>
        <div class="legend-item">
          <span class="legend-label">Y-axis = Transaction frequency</span>
        </div>
      </div>
    </div>
  </div>

  <!-- No Data State -->
  <div class="no-data-state" *ngIf="!isLoading && heatmapData.length === 0 && !financialIndicators.length">
    <div class="no-data-content">
      <i class="fas fa-chart-pie"></i>
      <h3>No Advanced Analytics Available</h3>
      <p>Add more transaction data to unlock advanced financial insights</p>
      <button class="btn btn-primary" routerLink="/financial/transactions/new">
        <i class="fas fa-plus"></i>
        Add Transaction
      </button>
    </div>
  </div>
</div>
