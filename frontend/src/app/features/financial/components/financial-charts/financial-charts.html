<div class="financial-charts-container" *ngIf="showCharts">
    <!-- Header Section -->
    <div class="charts-header">
      <h2>Financial Analytics</h2>
      <p class="subtitle">Visual insights into your financial patterns</p>
      
      <div class="chart-controls">
        <div class="period-selector">
          <label for="periodSelect">Time Period:</label>
          <select id="periodSelect" [(ngModel)]="period" (change)="onPeriodChange(period)" class="form-select">
            <option value="day">Daily</option>
            <option value="week">Weekly</option>
            <option value="month">Monthly</option>
            <option value="quarter">Quarterly</option>
            <option value="year">Yearly</option>
          </select>
        </div>
        
        <div class="action-buttons">
          <button class="btn btn-outline-primary" (click)="refreshCharts()">
            <i class="fas fa-redo"></i>
            Refresh
          </button>
          <button class="btn btn-outline-secondary" (click)="exportChartData()">
            <i class="fas fa-download"></i>
            Export Data
          </button>
        </div>
      </div>
    </div>
  
    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Expense Trend Chart -->
      <div class="chart-card" *ngIf="expenseChartData">
        <div class="chart-header">
          <h3>Expense Trends</h3>
          <p class="chart-description">Monthly expense patterns over time</p>
        </div>
        <div class="chart-container">
          <canvas #expenseChart 
                  [attr.data-chart]="'expense'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Line Chart</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Data Points:</span>
              <span class="stat-value">{{ expenseChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Income Trend Chart -->
      <div class="chart-card" *ngIf="incomeChartData">
        <div class="chart-header">
          <h3>Income Trends</h3>
          <p class="chart-description">Monthly income patterns over time</p>
        </div>
        <div class="chart-container">
          <canvas #incomeChart 
                  [attr.data-chart]="'income'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Line Chart</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Data Points:</span>
              <span class="stat-value">{{ incomeChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Category Spending Chart -->
      <div class="chart-card" *ngIf="categoryChartData">
        <div class="chart-header">
          <h3>Spending by Category</h3>
          <p class="chart-description">Top spending categories breakdown</p>
        </div>
        <div class="chart-container">
          <canvas #categoryChart 
                  [attr.data-chart]="'category'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Pie Chart</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Categories:</span>
              <span class="stat-value">{{ categoryChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Net Income Trend Chart -->
      <div class="chart-card" *ngIf="trendChartData">
        <div class="chart-header">
          <h3>Net Income Trends</h3>
          <p class="chart-description">Monthly net income and cash flow</p>
          <div class="chart-actions">
            <button class="btn btn-sm btn-outline-secondary" (click)="exportChartAsImage('trend')">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        <div class="chart-container">
          <canvas #trendChart 
                  [attr.data-chart]="'trend'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Multi-line Chart</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Data Points:</span>
              <span class="stat-value">{{ trendChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Savings Rate Chart -->
      <div class="chart-card" *ngIf="savingsChartData">
        <div class="chart-header">
          <h3>Savings Rate Trend</h3>
          <p class="chart-description">Percentage of income saved over time</p>
          <div class="chart-actions">
            <button class="btn btn-sm btn-outline-secondary" (click)="exportChartAsImage('savings')">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        <div class="chart-container">
          <canvas #savingsChart 
                  [attr.data-chart]="'savings'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Line Chart</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Data Points:</span>
              <span class="stat-value">{{ savingsChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Income vs Expenses Scatter Plot -->
      <div class="chart-card" *ngIf="scatterChartData">
        <div class="chart-header">
          <h3>Income vs Expenses Correlation</h3>
          <p class="chart-description">Relationship between income and spending patterns</p>
          <div class="chart-actions">
            <button class="btn btn-sm btn-outline-secondary" (click)="exportChartAsImage('scatter')">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        <div class="chart-container">
          <canvas #scatterChart 
                  [attr.data-chart]="'scatter'"
                  (click)="onChartClick($event)">
          </canvas>
        </div>
        <div class="chart-footer">
          <div class="chart-stats">
            <div class="stat-item">
              <span class="stat-label">Chart Type:</span>
              <span class="stat-value">Scatter Plot</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Data Points:</span>
              <span class="stat-value">{{ scatterChartData.labels.length || 0 }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Metrics Summary -->
    <div class="metrics-summary" *ngIf="financialMetrics">
      <div class="metrics-header">
        <h3>Financial Health Summary</h3>
        <p>Key metrics from your financial data</p>
      </div>
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-arrow-up text-success"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Income</div>
            <div class="metric-value">${{ financialMetrics.totalIncome | number:'1.2-2' }}</div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-arrow-down text-danger"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Expenses</div>
            <div class="metric-value">${{ financialMetrics.totalExpenses | number:'1.2-2' }}</div>
          </div>
        </div>
        
        <div class="metric-card" [class.positive]="financialMetrics.netIncome > 0" [class.negative]="financialMetrics.netIncome < 0">
          <div class="metric-icon">
            <i class="fas fa-balance-scale"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Net Income</div>
            <div class="metric-value">${{ financialMetrics.netIncome | number:'1.2-2' }}</div>
          </div>
        </div>
        
        <div class="metric-card" [class.positive]="financialMetrics.savingsRate > 20" [class.warning]="financialMetrics.savingsRate > 10 && financialMetrics.savingsRate <= 20" [class.negative]="financialMetrics.savingsRate <= 10">
          <div class="metric-icon">
            <i class="fas fa-percentage"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Savings Rate</div>
            <div class="metric-value">{{ financialMetrics.savingsRate | number:'1.1-1' }}%</div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-tag"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Top Category</div>
            <div class="metric-value">{{ financialMetrics.topCategory }}</div>
            <div class="metric-subvalue">${{ financialMetrics.topCategoryAmount | number:'1.2-2' }}</div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Avg Monthly Income</div>
            <div class="metric-value">${{ financialMetrics.averageMonthlyIncome | number:'1.2-2' }}</div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- No Data State -->
    <div class="no-data-state" *ngIf="!expenseChartData && !incomeChartData && !categoryChartData && !trendChartData">
      <div class="no-data-content">
        <i class="fas fa-chart-line"></i>
        <h3>No Chart Data Available</h3>
        <p>Start adding transactions to see your financial analytics</p>
        <button class="btn btn-primary" routerLink="/financial/transactions/new">
          <i class="fas fa-plus"></i>
          Add Transaction
        </button>
      </div>
    </div>
  
    <!-- Chart Loading State -->
    <div class="loading-state" *ngIf="transactions.length === 0">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Loading transaction data...</p>
      </div>
    </div>
  </div>