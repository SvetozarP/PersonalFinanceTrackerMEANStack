<div class="financial-reports-container">
    <!-- Header Section -->
    <div class="reports-header">
      <div class="header-content">
        <h1>Financial Reports</h1>
        <p class="subtitle">Generate comprehensive financial insights and analysis</p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-outline-secondary" (click)="toggleAdvancedOptions()">
          <i class="fas fa-cog"></i>
          {{ showAdvancedOptions ? 'Hide' : 'Show' }} Options
        </button>
        
        <button class="btn btn-primary" (click)="exportReport('pdf')" *ngIf="reportData">
          <i class="fas fa-download"></i>
          Export Report
        </button>
        
        <button class="btn btn-outline-primary" (click)="printReport()" *ngIf="reportData">
          <i class="fas fa-print"></i>
          Print
        </button>
      </div>
    </div>
  
    <!-- Report Configuration -->
    <div class="report-configuration">
      <div class="config-section">
        <div class="config-group">
          <label for="period">Report Period:</label>
          <select id="period" [(ngModel)]="selectedPeriod" (change)="onPeriodChange(selectedPeriod)" class="form-control">
            <option *ngFor="let period of periods" [value]="period.value">
              {{ period.label }}
            </option>
          </select>
        </div>
  
        <div class="config-group">
          <label for="reportType">Report Type:</label>
          <select id="reportType" [(ngModel)]="selectedReportType" (change)="onReportTypeChange(selectedReportType)" class="form-control">
            <option *ngFor="let reportType of reportTypes" [value]="reportType.value">
              <i [class]="reportType.icon"></i>
              {{ reportType.label }}
            </option>
          </select>
        </div>
  
        <!-- Time Granularity Control (only for trends) -->
        <div class="config-group" *ngIf="selectedReportType === 'trends'">
          <label for="granularity">Time Granularity:</label>
          <select id="granularity" [(ngModel)]="selectedGranularity" (change)="onGranularityChange(selectedGranularity)" class="form-control">
            <option *ngFor="let option of granularityOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <small class="form-text text-muted" *ngIf="selectedGranularity !== 'auto'">
            {{ getGranularityDescription(selectedGranularity) }}
          </small>
        </div>
  
        <!-- Custom Date Range -->
        <div class="config-group" *ngIf="customDateRange">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate" [(ngModel)]="startDate" (change)="onDateRangeChange()" class="form-control">
        </div>
  
        <div class="config-group" *ngIf="customDateRange">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate" [(ngModel)]="endDate" (change)="onDateRangeChange()" class="form-control">
        </div>
      </div>
  
      <!-- Advanced Options -->
      <div class="advanced-options" *ngIf="showAdvancedOptions">
        <div class="options-header">
          <h3>Advanced Options</h3>
          <p>Customize your report generation</p>
        </div>
        
        <div class="options-grid">
          <div class="option-item">
            <label class="checkbox-label">
              <input type="checkbox" checked>
              <span class="checkmark"></span>
              Include Category Breakdown
            </label>
          </div>
          
          <div class="option-item">
            <label class="checkbox-label">
              <input type="checkbox" checked>
              <span class="checkmark"></span>
              Include Trend Analysis
            </label>
          </div>
          
          <div class="option-item">
            <label class="checkbox-label">
              <input type="checkbox" checked>
              <span class="checkmark"></span>
              Include Insights
            </label>
          </div>
          
          <div class="option-item">
            <label class="checkbox-label">
              <input type="checkbox">
              <span class="checkmark"></span>
              Include Budget Comparison
            </label>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading">
      <div class="loading-content">
        <div class="spinner"></div>
        <h3>Generating Report...</h3>
        <p>Please wait while we analyze your financial data</p>
      </div>
    </div>
  
    <!-- Report Content -->
    <div class="report-content" *ngIf="!isLoading && (reportData || hasMultipleCurrencies())">
      <!-- Report Header -->
      <div class="report-header">
        <div class="report-title">
          <h2>{{ selectedReportType | titlecase }} Report</h2>
          <p class="report-period">
            {{ reportData?.period?.start | date:'mediumDate' }} - {{ reportData?.period?.end | date:'mediumDate' }}
          </p>
        </div>
        
        <div class="report-meta">
          <span class="meta-item">
            <i class="fas fa-calendar"></i>
            Generated: {{ getCurrentDate() | date:'medium' }}
          </span>
          <span class="meta-item">
            <i class="fas fa-chart-bar"></i>
            {{ getCurrentSummary()?.transactionCount }} transactions
          </span>
        </div>
      </div>
  
      <!-- Summary Report -->
      <div class="report-section summary-section" *ngIf="selectedReportType === 'summary'">
        <h3>Executive Summary</h3>
        <div class="summary-grid">
          <div class="summary-card income">
            <div class="card-header">
              <i class="fas fa-arrow-up"></i>
              <span>Total Income</span>
            </div>
            <div class="card-value">{{ getCurrentSummary()?.totalIncome | currency:getCurrentCurrency() }}</div>
            <div class="card-change positive">+12.5% vs last period</div>
          </div>
  
          <div class="summary-card expenses">
            <div class="card-header">
              <i class="fas fa-arrow-down"></i>
              <span>Total Expenses</span>
            </div>
            <div class="card-value">{{ getCurrentSummary()?.totalExpenses | currency:getCurrentCurrency() }}</div>
            <div class="card-change negative">+8.2% vs last period</div>
          </div>
  
          <div class="summary-card net">
            <div class="card-header">
              <i class="fas fa-balance-scale"></i>
              <span>Net Income</span>
            </div>
            <div class="card-value" [class.positive]="(getCurrentSummary()?.netAmount ?? 0) >= 0" [class.negative]="(getCurrentSummary()?.netAmount ?? 0) < 0">
              {{ getCurrentSummary()?.netAmount | currency:getCurrentCurrency() }}
            </div>
            <div class="card-change" [class.positive]="(getCurrentSummary()?.netAmount ?? 0) >= 0" [class.negative]="(getCurrentSummary()?.netAmount ?? 0) < 0">
              {{ (getCurrentSummary()?.netAmount ?? 0) >= 0 ? '+' : '' }}{{ (getCurrentSummary()?.netAmount ?? 0) >= 0 ? '12.5' : '8.2' }}% vs last period
            </div>
          </div>
  
          <div class="summary-card transfers">
            <div class="card-header">
              <i class="fas fa-exchange-alt"></i>
              <span>Total Transfers</span>
            </div>
            <div class="card-value">{{ getCurrentSummary()?.totalTransfers | currency:getCurrentCurrency() }}</div>
            <div class="card-change neutral">No change</div>
          </div>
        </div>
      </div>

      <!-- Detailed Report -->
      <div class="report-section detailed-section" *ngIf="selectedReportType === 'detailed'">
        <h3>Detailed Transaction Analysis</h3>
        
        <!-- Transaction Statistics -->
        <div class="detailed-stats">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-receipt"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ getCurrentSummary()?.transactionCount || 0 }}</div>
              <div class="stat-label">Total Transactions</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-calculator"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ ((getCurrentSummary()?.totalIncome ?? 0) + (getCurrentSummary()?.totalExpenses ?? 0)) / (getCurrentSummary()?.transactionCount ?? 1) | currency:getCurrentCurrency() }}</div>
              <div class="stat-label">Average Transaction</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-arrow-up"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ getCurrentSummary()?.totalIncome | currency:getCurrentCurrency() }}</div>
              <div class="stat-label">Total Income</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-arrow-down"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ getCurrentSummary()?.totalExpenses | currency:getCurrentCurrency() }}</div>
              <div class="stat-label">Total Expenses</div>
            </div>
          </div>
        </div>

        <!-- Transaction Breakdown Chart -->
        <div class="chart-section">
          <h4>Transaction Breakdown</h4>
          <div class="chart-container">
            <div class="breakdown-chart">
              <div class="chart-header">
                <div class="chart-title">Income vs Expenses</div>
                <div class="chart-total">Total: {{ ((getCurrentSummary()?.totalIncome ?? 0) + (getCurrentSummary()?.totalExpenses ?? 0)) | currency:getCurrentCurrency() }}</div>
              </div>
              
              <div class="chart-bars">
                <div class="chart-bar income-bar" [style.width.%]="getIncomePercentage()">
                  <div class="bar-content">
                    <div class="bar-label">Income</div>
                    <div class="bar-amount">{{ getCurrentSummary()?.totalIncome | currency:getCurrentCurrency() }}</div>
                    <div class="bar-percentage">{{ getIncomePercentage() | number:'1.1-1' }}%</div>
                  </div>
                </div>
                <div class="chart-bar expense-bar" [style.width.%]="getExpensePercentage()">
                  <div class="bar-content">
                    <div class="bar-label">Expenses</div>
                    <div class="bar-amount">{{ getCurrentSummary()?.totalExpenses | currency:getCurrentCurrency() }}</div>
                    <div class="bar-percentage">{{ getExpensePercentage() | number:'1.1-1' }}%</div>
                  </div>
                </div>
              </div>
              
              <div class="chart-legend">
                <div class="legend-item">
                  <div class="legend-color income"></div>
                  <span>Income ({{ getIncomePercentage() | number:'1.1-1' }}%)</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color expense"></div>
                  <span>Expenses ({{ getExpensePercentage() | number:'1.1-1' }}%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Key Insights -->
        <div class="insights-section" *ngIf="reportData?.insights && (reportData?.insights?.length ?? 0) > 0">
          <h4>Key Insights</h4>
          <div class="insights-grid">
            <div class="insight-card" *ngFor="let insight of reportData?.insights">
              <div class="insight-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="insight-content">
                <p>{{ insight }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Transactions List -->
        <div class="transactions-section" *ngIf="transactions.length > 0">
          <h4>Recent Transactions</h4>
          <div class="transactions-list">
            <div class="transaction-item" *ngFor="let transaction of transactions.slice(0, 10)">
              <div class="transaction-info">
                <div class="transaction-description">{{ transaction.description }}</div>
                <div class="transaction-meta">
                  <span class="transaction-category">{{ getCategoryName(transaction.categoryId) || 'Uncategorized' }}</span>
                  <span class="transaction-date">{{ transaction.date | date:'short' }}</span>
                </div>
              </div>
              <div class="transaction-amount" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                {{ transaction.amount | currency:transaction.currency }}
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Category Analysis Report -->
      <div class="report-section category-section" *ngIf="selectedReportType === 'category'">
        <h3>Category Analysis</h3>
        <div class="category-table" *ngIf="getCurrentReportData()?.categories && (getCurrentReportData()?.categories?.length ?? 0) > 0">
          <div class="table-header">
            <div class="header-cell">Category</div>
            <div class="header-cell">Amount</div>
            <div class="header-cell">Count</div>
            <div class="header-cell">Percentage</div>
            <div class="header-cell">Trend</div>
          </div>
          
          <div class="table-row" *ngFor="let category of getCurrentReportData()?.categories?.slice(0, 10)">
            <div class="table-cell category-name">
              <i class="fas fa-tag"></i>
              {{ category.categoryName || category.name || 'Uncategorized' }}
            </div>
            <div class="table-cell amount" [class.positive]="category.isPositive" [class.negative]="!category.isPositive">
              {{ category.total || category.amount | currency:getCurrentCurrency() }}
            </div>
            <div class="table-cell count">{{ category.count }}</div>
            <div class="table-cell percentage">
              <div class="percentage-bar">
                <div class="bar-fill" [style.width.%]="category.percentage"></div>
              </div>
              {{ category.percentage | number:'1.1-1' }}%
            </div>
            <div class="table-cell trend">
              <i class="fas fa-arrow-up text-success"></i>
              +5.2%
            </div>
          </div>
        </div>
        <div *ngIf="!getCurrentReportData()?.categories || getCurrentReportData()?.categories?.length === 0" class="no-data">
          <i class="fas fa-info-circle"></i>
          <p>No category data available for this period</p>
        </div>
      </div>
  
      <!-- Trend Analysis Report -->
      <div class="report-section trends-section" *ngIf="selectedReportType === 'trends'">
        <h3>Trend Analysis</h3>
        
        <!-- Trend Summary -->
        <div class="trend-summary" *ngIf="getCurrentReportData()?.trends && (getCurrentReportData()?.trends?.length ?? 0) > 0">
          <div class="trend-analysis-card">
            <div class="analysis-header">
              <h4>Financial Trend Analysis</h4>
              <div class="overall-trend" [class]="getOverallTrendColorClass()">
                {{ getOverallTrendAnalysis() }}
              </div>
            </div>
            <div class="analysis-details">
              <div class="detail-item">
                <span class="label">Period:</span>
                <span class="value">{{ getPeriodLength() }} month{{ getPeriodLength() > 1 ? 's' : '' }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Net for Period:</span>
                <span class="value" [class.positive]="getLatestChangeAbsolute() >= 0" [class.negative]="getLatestChangeAbsolute() < 0">
                  {{ getLatestChangeAbsolute() >= 0 ? '+' : '' }}{{ getLatestChangeAbsolute() | currency:getCurrentCurrency() }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Trend Analysis Line Chart -->
        <div class="trends-chart" *ngIf="getCurrentReportData()?.trends && (getCurrentReportData()?.trends?.length ?? 0) > 0">
          <h4>Financial Trend Analysis</h4>
          <div class="chart-container">
            <div class="line-chart">
              <div class="chart-header">
                <div class="chart-title">Spending Trend</div>
                <div class="chart-legend">
                  <div class="legend-item">
                    <div class="legend-color income"></div>
                    <span>Income</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color expense"></div>
                    <span>Expenses</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color net"></div>
                    <span>Net</span>
                  </div>
                </div>
              </div>
              
              <div class="chart-content">
                <svg class="line-chart-svg" [attr.viewBox]="'0 0 900 450'">
                  <!-- Grid lines -->
                  <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e9ecef" stroke-width="1" opacity="0.3"/>
                    </pattern>
                  </defs>
                  <rect width="100%" height="100%" fill="url(#grid)" />
                  
                  <!-- Y-axis grid lines -->
                  <g class="y-grid-lines">
                    <line *ngFor="let tick of getYAxisTicks(); let i = index" 
                          [attr.x1]="100" 
                          [attr.y1]="getYAxisPosition(tick)" 
                          [attr.x2]="800" 
                          [attr.y2]="getYAxisPosition(tick)" 
                          stroke="#e9ecef" 
                          stroke-width="1" 
                          opacity="0.5"/>
                  </g>
                  
                  <!-- X-axis grid lines -->
                  <g class="x-grid-lines">
                    <line *ngFor="let trend of getCurrentReportData()?.trends; let i = index" 
                          [attr.x1]="getXAxisPosition(i)" 
                          [attr.y1]="50" 
                          [attr.x2]="getXAxisPosition(i)" 
                          [attr.y2]="400" 
                          stroke="#e9ecef" 
                          stroke-width="1" 
                          opacity="0.5"/>
                  </g>
                  
                  <!-- Y-axis labels -->
                  <g class="y-axis">
                    <text *ngFor="let tick of getYAxisTicks(); let i = index" 
                          [attr.x]="80" 
                          [attr.y]="getYAxisPosition(tick)" 
                          text-anchor="end" 
                          dominant-baseline="middle" 
                          class="axis-label">
                      {{ tick | number:'1.0-0' }}
                    </text>
                  </g>
                  
                  <!-- X-axis labels -->
                  <g class="x-axis">
                    <text *ngFor="let trend of getChartTrends(); let i = index" 
                          [attr.x]="getXAxisPosition(i)" 
                          [attr.y]="420" 
                          text-anchor="end" 
                          dominant-baseline="middle" 
                          [attr.transform]="'rotate(-45, ' + getXAxisPosition(i) + ', 420)'"
                          class="axis-label x-axis-label">
                      {{ formatTrendDate(trend) }}
                    </text>
                  </g>
                  
                  <!-- Income line -->
                  <polyline 
                    class="trend-line income-line"
                    [attr.points]="getLineChartPoints('income')"
                    fill="none"
                    stroke="#28a745"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                  </polyline>
                  
                  <!-- Expense line -->
                  <polyline 
                    class="trend-line expense-line"
                    [attr.points]="getLineChartPoints('expense')"
                    fill="none"
                    stroke="#dc3545"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                  </polyline>
                  
                  <!-- Net line -->
                  <polyline 
                    class="trend-line net-line"
                    [attr.points]="getLineChartPoints('net')"
                    fill="none"
                    stroke="#007bff"
                    stroke-width="4"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                  </polyline>
                  
                  <!-- Data points -->
                  <g class="data-points">
                    <circle *ngFor="let trend of getChartTrends(); let i = index" 
                            [attr.cx]="getXAxisPosition(i)" 
                            [attr.cy]="getYAxisPosition(trend.income)" 
                            r="4" 
                            fill="#28a745" 
                            class="data-point income-point">
                      <title>{{ trend.income | currency:getCurrentCurrency() }}</title>
                    </circle>
                    <circle *ngFor="let trend of getChartTrends(); let i = index" 
                            [attr.cx]="getXAxisPosition(i)" 
                            [attr.cy]="getYAxisPosition(trend.expenses)" 
                            r="4" 
                            fill="#dc3545" 
                            class="data-point expense-point">
                      <title>{{ trend.expenses | currency:getCurrentCurrency() }}</title>
                    </circle>
                    <circle *ngFor="let trend of getChartTrends(); let i = index" 
                            [attr.cx]="getXAxisPosition(i)" 
                            [attr.cy]="getYAxisPosition(trend.net)" 
                            r="5" 
                            fill="#007bff" 
                            class="data-point net-point">
                      <title>{{ trend.net | currency:getCurrentCurrency() }}</title>
                    </circle>
                  </g>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Trend Data Table -->
        <div class="trend-table" *ngIf="getCurrentReportData()?.trends && (getCurrentReportData()?.trends?.length ?? 0) > 0">
          <h4>Detailed Trend Data</h4>
          <div class="table-container">
            <table class="trends-table">
              <thead>
                <tr>
                  <th>Month</th>
                  <th>Income</th>
                  <th>Expenses</th>
                  <th>Net</th>
                  <th>Change</th>
                  <th>Trend</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let trend of getTableTrends(); let i = index">
                  <td class="month-cell">
                    <div class="month-info">
                      <span class="month-name">{{ formatTrendDate(trend) }}</span>
                      <span class="month-indicator" [class.current]="i === 0" [class.previous]="i === 1">
                        {{ i === 0 ? 'Current' : i === 1 ? 'Previous' : '' }}
                      </span>
                    </div>
                  </td>
                  <td class="income">
                    <div class="amount-cell">
                      <span class="amount">{{ trend.income | currency:getCurrentCurrency() }}</span>
                      <div class="trend-indicator income" [class.positive]="trend.income > 0" [class.zero]="trend.income === 0">
                        <i class="fas fa-arrow-up" *ngIf="trend.income > 0"></i>
                        <i class="fas fa-minus" *ngIf="trend.income === 0"></i>
                      </div>
                    </div>
                  </td>
                  <td class="expense">
                    <div class="amount-cell">
                      <span class="amount">{{ trend.expenses | currency:getCurrentCurrency() }}</span>
                      <div class="trend-indicator expense" [class.positive]="trend.expenses > 0" [class.zero]="trend.expenses === 0">
                        <i class="fas fa-arrow-up" *ngIf="trend.expenses > 0"></i>
                        <i class="fas fa-minus" *ngIf="trend.expenses === 0"></i>
                      </div>
                    </div>
                  </td>
                  <td [class.positive]="trend.net >= 0" [class.negative]="trend.net < 0">
                    <div class="amount-cell">
                      <span class="amount">{{ trend.net | currency:getCurrentCurrency() }}</span>
                      <div class="trend-indicator net" [class.positive]="trend.net >= 0" [class.negative]="trend.net < 0">
                        <i class="fas fa-arrow-up" *ngIf="trend.net > 0"></i>
                        <i class="fas fa-arrow-down" *ngIf="trend.net < 0"></i>
                        <i class="fas fa-minus" *ngIf="trend.net === 0"></i>
                      </div>
                    </div>
                  </td>
                  <td [class.positive]="getTrendChange(trend, i) >= 0" [class.negative]="getTrendChange(trend, i) < 0">
                    <div class="change-cell">
                      <span class="change-value" [class.positive]="getTrendChange(trend, i) >= 0" [class.negative]="getTrendChange(trend, i) < 0">
                        {{ getTrendChange(trend, i) >= 0 ? '+' : '' }}{{ getTrendChange(trend, i) | currency:getCurrentCurrency() }}
                      </span>
                      <div class="change-bar">
                        <div class="change-fill" [style.width.%]="getChangePercentage(trend, i)" 
                             [class.positive]="getTrendChange(trend, i) >= 0" 
                             [class.negative]="getTrendChange(trend, i) < 0"></div>
                      </div>
                    </div>
                  </td>
                  <td class="trend-visual">
                    <div class="trend-indicator" [class]="getTrendColorClass(trend, i)">
                      <i [class]="getTrendIcon(trend, i)"></i>
                      <span class="trend-label">{{ getTrendDirection(trend, i) | titlecase }}</span>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div *ngIf="!getCurrentReportData()?.trends || (getCurrentReportData()?.trends?.length ?? 0) === 0" class="no-data">
          <i class="fas fa-chart-line"></i>
          <p>No trend data available for this period</p>
        </div>
      </div>

      <!-- Budget Analysis Report -->
      <div class="report-section budget-section" *ngIf="selectedReportType === 'budget'">
        <h3>Budget Analysis</h3>
        
        <!-- Budget Performance Overview -->
        <div class="budget-overview">
          <div class="budget-cards">
            <div class="budget-card">
              <div class="budget-icon">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="budget-content">
                <div class="budget-value">{{ getCurrentSummary()?.totalExpenses | currency:getCurrentCurrency() }}</div>
                <div class="budget-label">Total Spending</div>
              </div>
            </div>
            
            <div class="budget-card">
              <div class="budget-icon">
                <i class="fas fa-chart-pie"></i>
              </div>
              <div class="budget-content">
                <div class="budget-value">{{ getBudgetUtilization() | number:'1.1-1' }}%</div>
                <div class="budget-label">Budget Utilization</div>
              </div>
            </div>
            
            <div class="budget-card">
              <div class="budget-icon">
                <i class="fas fa-balance-scale"></i>
              </div>
              <div class="budget-content">
                <div class="budget-value" [class.positive]="getBudgetVariance() >= 0" [class.negative]="getBudgetVariance() < 0">
                  {{ getBudgetVariance() | currency }}
                </div>
                <div class="budget-label">Budget Variance</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Budget vs Actual Chart -->
        <div class="budget-chart-section">
          <h4>Budget vs Actual Spending</h4>
          <div class="chart-container">
            <div class="budget-chart">
              <div class="chart-header">
                <div class="chart-title">Budget Performance</div>
                <div class="chart-legend">
                  <div class="legend-item">
                    <div class="legend-color budget"></div>
                    <span>Budget ({{ getBudgetAmount() | currency }})</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color actual"></div>
                    <span>Actual ({{ getCurrentSummary()?.totalExpenses | currency }})</span>
                  </div>
                </div>
              </div>
              
              <div class="chart-bars">
                <div class="budget-bar">
                  <div class="bar-label">Budget</div>
                  <div class="bar-container">
                    <div class="bar-fill budget-fill" [style.width.%]="getBudgetPercentage()">
                      <div class="bar-value">{{ getBudgetAmount() | currency }}</div>
                    </div>
                  </div>
                </div>
                <div class="budget-bar">
                  <div class="bar-label">Actual</div>
                  <div class="bar-container">
                    <div class="bar-fill actual-fill" [style.width.%]="getActualPercentage()">
                      <div class="bar-value">{{ getCurrentSummary()?.totalExpenses | currency }}</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="chart-summary">
                <div class="summary-item">
                  <span class="summary-label">Budget Utilization:</span>
                  <span class="summary-value" [class.warning]="getBudgetUtilization() > 80" [class.danger]="getBudgetUtilization() > 100">
                    {{ getBudgetUtilization() | number:'1.1-1' }}%
                  </span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Variance:</span>
                  <span class="summary-value" [class.positive]="getBudgetVariance() >= 0" [class.negative]="getBudgetVariance() < 0">
                    {{ getBudgetVariance() | currency }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Category Budget Analysis -->
        <div class="category-budget-section" *ngIf="reportData?.categories && (reportData?.categories?.length ?? 0) > 0">
          <h4>Category Budget Analysis</h4>
          <div class="category-budget-grid">
            <div class="category-budget-item" *ngFor="let category of (reportData?.categories || []).slice(0, 8)">
              <div class="category-header">
                <div class="category-name">{{ category.categoryName || 'Uncategorized' }}</div>
                <div class="category-amount" [class.positive]="category.isPositive" [class.negative]="!category.isPositive">
                  {{ category.total || category.amount | currency }}
                </div>
              </div>
              <div class="category-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="getCategoryBudgetPercentage(category)">
                    <span class="progress-text">{{ getCategoryBudgetPercentage(category) | number:'1.1-1' }}%</span>
                  </div>
                </div>
              </div>
              <div class="category-stats">
                <div class="stat-item">
                  <span class="stat-label">Count:</span>
                  <span class="stat-value">{{ category.count }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Avg:</span>
                  <span class="stat-value">{{ ((category.total || category.amount) / category.count) | currency }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Budget Recommendations -->
        <div class="budget-recommendations" *ngIf="reportData?.insights && (reportData?.insights?.length ?? 0) > 0">
          <h4>Budget Recommendations</h4>
          <div class="recommendations-grid">
            <div class="recommendation-card" *ngFor="let insight of reportData?.insights">
              <div class="recommendation-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="recommendation-content">
                <p>{{ insight }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Budget Alerts -->
        <div class="budget-alerts">
          <h4>Budget Alerts</h4>
          <div class="alerts-list">
            <div class="alert-item" *ngIf="getBudgetVariance() < 0" [class.warning]="getBudgetVariance() < -100" [class.danger]="getBudgetVariance() < -500">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Over budget by {{ Math.abs(getBudgetVariance()) | currency }}</span>
            </div>
            <div class="alert-item" *ngIf="getBudgetUtilization() > 80" [class.warning]="getBudgetUtilization() > 90" [class.danger]="getBudgetUtilization() > 100">
              <i class="fas fa-chart-line"></i>
              <span>High budget utilization: {{ getBudgetUtilization() | number:'1.1-1' }}%</span>
            </div>
            <div class="alert-item" *ngIf="getBudgetVariance() >= 0 && getBudgetUtilization() < 50">
              <i class="fas fa-check-circle"></i>
              <span>Good budget management - under budget by {{ getBudgetVariance() | currency }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Multi-Currency Reports -->
      <div *ngIf="hasMultipleCurrencies()" class="multi-currency-reports">
        <h3>Multi-Currency Reports</h3>
        <div class="currency-tabs">
          <button 
            *ngFor="let currency of getAvailableCurrencies()" 
            class="currency-tab"
            [class.active]="selectedCurrency === currency"
            (click)="onCurrencyChange(currency)">
            {{ currency }}
          </button>
        </div>
        
      </div>
  
      <!-- Report Footer -->
      <div class="report-footer">
        <div class="footer-content">
          <p class="disclaimer">
            This report is generated based on your transaction data. For financial advice, please consult with a qualified professional.
          </p>
          <div class="footer-actions">
            <button class="btn btn-outline-primary" (click)="exportReport('csv')">
              <i class="fas fa-file-csv"></i>
              Export CSV
            </button>
            <button class="btn btn-outline-primary" (click)="exportReport('excel')">
              <i class="fas fa-file-excel"></i>
              Export Excel
            </button>
          </div>
        </div>
      </div>
    </div>
  
    <!-- No Data State -->
    <div class="no-data-state" *ngIf="!isLoading && !reportData && !hasMultipleCurrencies() && transactions.length === 0">
      <div class="no-data-content">
        <i class="fas fa-chart-bar"></i>
        <h3>No Data Available</h3>
        <p>No transactions found for the selected period. Try adjusting your date range or add some transactions.</p>
        <button class="btn btn-primary" routerLink="/financial/transactions/new">
          <i class="fas fa-plus"></i>
          Add Transaction
        </button>
      </div>
    </div>
  </div>