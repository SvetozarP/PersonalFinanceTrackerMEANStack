<div class="dashboard-container">
    <!-- Loading State -->
    <div *ngIf="isLoading()" class="loading-container">
      <app-loading-spinner [size]="'large'" [message]="'Loading dashboard...'"></app-loading-spinner>
    </div>
  
    <!-- Error State -->
    <div *ngIf="error() && !isLoading()" class="error-container">
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{ error() }}</span>
        <button class="btn btn-primary" (click)="refreshDashboard()">
          <i class="fas fa-redo"></i>
          Retry
        </button>
      </div>
    </div>
  
    <!-- Dashboard Content -->
    <div *ngIf="isDataLoaded()" class="dashboard-content">
      <!-- Header Section -->
      <div class="header-section">
        <div class="title-section">
          <h1>Financial Dashboard</h1>
          <p class="subtitle">Overview of your financial health</p>
        </div>
        <div class="actions-section">
          <button class="btn btn-secondary" (click)="refreshDashboard()" [disabled]="isLoading()">
            <i class="fas fa-redo"></i>
            Refresh
          </button>
          <button class="btn btn-primary" routerLink="/financial/transactions/new">
            <i class="fas fa-plus"></i>
            New Transaction
          </button>
          <button class="btn btn-danger" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </button>
        </div>
      </div>
  
      <!-- Key Metrics -->
      <div class="metrics-grid">
        <!-- Total Balance -->
        <div class="metric-card balance">
          <div class="metric-icon">
            <i class="fas fa-wallet"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Balance</div>
            <div class="metric-value">{{ getTotalBalance() | currency }}</div>
            <div class="metric-change positive">
              <i class="fas fa-arrow-up"></i>
              +{{ getSavingsRate() | number:'1.1-1' }}%
            </div>
          </div>
        </div>
  
        <!-- Total Income -->
        <div class="metric-card income">
          <div class="metric-icon">
            <i class="fas fa-arrow-down"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Income</div>
            <div class="metric-value">{{ getTotalIncome() | currency }}</div>
            <div class="metric-period">This Month</div>
          </div>
        </div>
  
        <!-- Total Expenses -->
        <div class="metric-card expenses">
          <div class="metric-icon">
            <i class="fas fa-arrow-up"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Expenses</div>
            <div class="metric-value">{{ getTotalExpenses() | currency }}</div>
            <div class="metric-period">This Month</div>
          </div>
        </div>
  
        <!-- Net Worth -->
        <div class="metric-card networth">
          <div class="metric-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="metric-content">
            <div class="metric-label">Net Worth</div>
            <div class="metric-value">{{ getNetWorth() | currency }}</div>
            <div class="metric-period">Current</div>
          </div>
        </div>
      </div>
  
      <!-- Charts Section -->
      <div class="charts-section">
        <div class="chart-row">
          <!-- Spending Trend -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>Spending Trend</h3>
              <div class="chart-actions">
                <button class="btn btn-sm btn-secondary" (click)="refreshDashboard()" [disabled]="isLoading()">
                  <i class="fas fa-redo"></i>
                  Refresh
                </button>
              </div>
            </div>
            <div class="chart-content">
              <app-responsive-chart
                [data]="spendingChartData()"
                [config]="{
                  type: 'line',
                  responsive: true,
                  maintainAspectRatio: false,
                  showLegend: true,
                  showTooltips: true,
                  showLabels: true,
                  animation: true,
                  colors: ['#e53e3e', '#38a169', '#3182ce']
                }"
                [loading]="isLoading()"
                [emptyMessage]="'No spending data available'">
              </app-responsive-chart>
            </div>
          </div>
  
          <!-- Income Trend -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>Income Trend</h3>
              <div class="chart-actions">
                <button class="btn btn-sm btn-secondary" (click)="refreshDashboard()" [disabled]="isLoading()">
                  <i class="fas fa-redo"></i>
                  Refresh
                </button>
              </div>
            </div>
            <div class="chart-content">
              <app-responsive-chart
                [data]="incomeChartData()"
                [config]="{
                  type: 'bar',
                  responsive: true,
                  maintainAspectRatio: false,
                  showLegend: true,
                  showTooltips: true,
                  showLabels: true,
                  animation: true,
                  colors: ['#38a169', '#3182ce', '#e53e3e']
                }"
                [loading]="isLoading()"
                [emptyMessage]="'No income data available'">
              </app-responsive-chart>
            </div>
          </div>
        </div>
  
        <!-- Category Spending -->
        <div class="chart-card full-width">
          <div class="chart-header">
            <h3>Spending by Category</h3>
            <div class="chart-actions">
              <button class="btn btn-sm btn-secondary" (click)="refreshCategoryStats()" [disabled]="isLoading()">
                <i class="fas fa-redo"></i>
                Refresh
              </button>
            </div>
          </div>
          <div class="chart-content">
            <app-responsive-chart
              [data]="categoryChartData()"
              [config]="{
                type: 'pie',
                responsive: true,
                maintainAspectRatio: false,
                showLegend: true,
                showTooltips: true,
                showLabels: true,
                animation: true,
                colors: ['#3182ce', '#38a169', '#e53e3e', '#805ad5', '#d69e2e']
              }"
              [loading]="isLoading()"
              [emptyMessage]="'No category data available'">
            </app-responsive-chart>
          </div>
        </div>
      </div>
  
      <!-- Recent Transactions -->
      <div class="recent-transactions-section">
        <div class="section-header">
          <h3>Recent Transactions</h3>
          <div class="section-actions">
            <button class="btn btn-sm btn-secondary" (click)="refreshTransactions()" [disabled]="isRecentTransactionsLoading()">
              <i class="fas fa-redo"></i>
              Refresh
            </button>
            <button class="btn btn-sm btn-primary" routerLink="/financial/transactions">
              View All
            </button>
          </div>
        </div>
        
        <div class="transactions-content">
          <div *ngIf="isRecentTransactionsLoading()" class="transactions-loading">
            <app-loading-spinner [size]="'medium'" [message]="'Loading transactions...'"></app-loading-spinner>
          </div>
          
          <div *ngIf="!isRecentTransactionsLoading() && recentTransactions() && recentTransactions().length > 0" class="transactions-list">
            <div *ngFor="let transaction of recentTransactions()" class="transaction-item">
              <div class="transaction-icon">
                <i class="fas fa-credit-card"></i>
              </div>
              <div class="transaction-details">
                <div class="transaction-title">{{ transaction.title }}</div>
                <div class="transaction-category">{{ transaction.categoryId ? getCategoryName(transaction.categoryId) : 'Unknown' }}</div>
                <div class="transaction-date">{{ transaction.date | date:'shortDate' }}</div>
              </div>
              <div class="transaction-amount" [class.negative]="transaction.type === 'expense'" [class.positive]="transaction.type === 'income'">
                {{ transaction.amount | currency }}
              </div>
            </div>
          </div>
          
          <div *ngIf="!isRecentTransactionsLoading() && (!recentTransactions() || recentTransactions().length === 0)" class="transactions-empty">
            <i class="fas fa-receipt"></i>
            <p>No recent transactions</p>
            <button class="btn btn-primary" routerLink="/financial/transactions/new">
              Add First Transaction
            </button>
          </div>
        </div>
      </div>
  
      <!-- Quick Actions -->
      <div class="quick-actions-section">
        <div class="section-header">
          <h3>Quick Actions</h3>
        </div>
        <div class="actions-grid">
          <button class="action-card" routerLink="/financial/transactions/new">
            <div class="action-icon">
              <i class="fas fa-plus"></i>
            </div>
            <div class="action-label">New Transaction</div>
          </button>
          <button class="action-card" routerLink="/financial/categories/new">
            <div class="action-icon">
              <i class="fas fa-tags"></i>
            </div>
            <div class="action-label">New Category</div>
          </button>
          <button class="action-card" routerLink="/financial/reports">
            <div class="action-icon">
              <i class="fas fa-chart-bar"></i>
            </div>
            <div class="action-label">View Reports</div>
          </button>
          <button class="action-card" routerLink="/financial/budgets">
            <div class="action-icon">
              <i class="fas fa-piggy-bank"></i>
            </div>
            <div class="action-label">Manage Budgets</div>
          </button>
        </div>
      </div>
    </div>
  </div>